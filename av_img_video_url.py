PRESTIGE_ITEMS = {
    'prestige': ['chn','gdl','afs','drc','esk','hrv','yrh','ama','abs','abp','bgn','sga','ppt','pxh','mgt','tus','tre','gwjac','vpc'],
    'kanbi': ['kpb','dtt'],
    'doc': ['cdc','sim','fcp','docp'],
    'onemore': ['onez'],
    'shiroutotv': ['siv'],
    'mbm': ['kum'],
    'projectdiamond': ['prb'],
    'jackson': ['jac','jnt'],
    'gets': ['ggen','gyan','gnab','gzap'],
    'kurofune': ['kfne'],
    'nanpatv': ['npv'],
    'luxutv': ['lxv'],
    'documentv': ['dcv']
}

AMA = {
    'nanpatv' : ["200gana"],
    'hamedori2nd' : ["328hmdnc"],
    'ara' : ["261ara"],
    'luxutv' : ["259luxu"],
    'prestige':["ymym"],
    'shirouto' : ['siro'],
    'scute' : ['229scute']
}

ALL_ITEMS = {
    '1': ['nag','gs','atom','sdmua','msfh','svvrt','mist','silkbt','shh','acme','nhdta','sdmf','mogi','stcv',"hunta",'drpt','mgold','votan','noskn','paioh','bkynb','mtall','hunt','sdfk','silku','star','stars','sdjs','sdnm','kmhr','sdth','kuse','sdab','sdmm','danuhd','nyh','zozo','ftht','akdl','silks','sdam','sdde','kire','shn','fsdss','fsvss','nhdtb','svdvd','iesp','piyo','dldss','sun','dandy','rctd','hawa','sw','ienf','gs','hbad','okb','dandan','nhvr','havd','mtvr','iesm','ftdss','okp','oks','svomn','hypn','sdnt','sdmu','nttr','fset','shyn','dvdm','miha'],
    '2': ['wpom','ekbe','dfe','wfr','ekw','wpvr','wkd'],  '12': ['bur','lol','imo','scr'], '13': ['gbd','gvg','dsvr','gqe','ovg','yvg','rvg'],
    '17':['mkd'],'18': ['mght','sprd','ntrd','spbx','mond'],  '21':['psd'],'24': ['dtsl','dfbvr','vdd','ped'],  '30': ['nha','msc','msa'],'33':['dph'],
    '36': ['doks','drop','DKWT'],  '41':['om','pjf','ly','pmc'],'42': ['sp'],'49':['mgdv'],     '55': ['davk','tmavntgvr','T28'], 
    '57': ['jksr','mcsr','itsr','bdsr','husr','sgsr'], '71': ['gas'],    '84': ['mdtm','mkmp','kmvr','umso'], 
    '86': ['axdvd'], '100': ['tv','yen'],'118':['giro','yzf'],     '125': ['umd'], '143': ['mom','shm'],     '149': ['rd'],    '171': ['lhtd'], '172': ['xrw'], '189': ['hsf'], '301': ['mbdd'],
    '422': ['kagd'], '433': ['gun','neo'], '436': ['bubb','yas'], '5013': ['tsds'], '504': ['ibw'],'540':['yst','wpe','bcm','tmg'],
    '5443': ['loota'], '5448': ['mwkd'], '5561': ['brth','flvr11','lvid','ftsh','vntg','shmo'], 
    '5581': ['pitv'], '5642': ['bndv','hodv'],'5050':['kkom'],   
    'h_021':['pym'],'h_068':['mxgs'], 'h_890':['mist'], 'h_1337': ['wvr9c'],'h_308':['aoz'],'h_491':['fone','kswp','nebo','ciel','tdmn', 'dori'],
    'h_1368': ['komz'], 'h_254': ['kir','ofku','spz','vnds','doki','mgdn','dmat','udak','nxg','kazk','eih'],
    'h_1248': ['kiwvr'], 'h_1462': ['com','pyu'], 'h_706': ['anda','coch','gredb','prbyb','sbmo','sprbd','thnib','ppmn'],
    'h_244': ['saba','supa'], 'h_1575': ['sgkx'], 'h_1256': ['tpvr','tprm'], 'h_1127': ['vovs','gopj','vosf','vosm'],
    'h_1116': ['cafuku','cami','casmani','cafr','capi','cabe','caca'], 'h_019': ['acz','kck'],'h_305':['bagbd'],
    'h_1100': ['hzgb','hzgd','hzhb'], 'h_1000': ['spye'], 'h_1001': ['oyaj'], 'h_1160': ['meko','mhar'],'h_1605':["stsk"],
    'h_1231': ['^ss$'], 'h_1300': ['mtes'],'h_1352':['knmd'], 'h_1628':['sat'], 'h_1534':['grmo'],
    'h_1435': ['clo','bth'], 'h_1573': ['ftuj'], 'h_1577': ['favkh','fbcpv'], 'h_496': ['dogd'],'h_213':['ageom'],
    'h_574': ['iqpa'], 'h_1569': ['nkkvr'], 'h_086': ['hthd','xmom','fera','keed','jrze','jura','mesu','nuka','abba','cvdx','toen','zeaa','iqqq','hima','ferax','iga','kaad','hone'],
    'h_1002': ['jgaho'], 'h_1386': ['dinm'], 'h_1492': ['siror'], 'h_1587': ['ein'], 'h_720': ['zex'],
    'h_1416': ['^ad$'], 'h_1563': ['mol'], 'h_094': ['ktra'], 'h_796': ['much'],'h_1609':['spivr'],'h_1615':['beaf'],
    'h_458': ['hsm'], 'h_1304': ['^tg$'], 'h_1526': ['pm'], 'h_1342': ['nsm'], 'h_1440': ['fgan'],
    'h_1594': ['spro'], 'h_1096': ['bdsm'], 'h_113': ['^(bbacos','cb','ek','kpp','spo','sw)$','syk','sy','izm'],
    'h_1165': ['goju'], 'h_1553': ['ftvr'], 'h_1560': ['shind'],'h_452':["tmcy"],'h_1068':['ftom'],
    'h_1345': ['gnax'], 'h_1558': ['csdx'], 'h_1593': ['cubex','fanq','fanx','papak'], 'h_172': ['HMNF'], 'h_1631': ['krs'],
    'h_173': ['ghmt','giro','ghkr','gtrl','ryoj','tbb','thp'], 'h_1454':['smdy'], 'h_1359':['swdf'],
    'h_189': ['cha','milf','pc','tsm','uta','vio'], 'h_237': ['find','ambi','ambs','clot','hdka','nacr','nacx','zmar'],
    'h_897': ['nmk','hict'], 'h_101': ['gs'], 'h_227': ['jukf'], 'h_1324': ['skmj'], 'h_1240': ['milk'],'h_1112':['nubi'],
    'h_1472': ['hmvf','stvf','instv'], 'h_1378': ['arso'], 'h_580': ['tms'], 'h_1533': ['can'], 'h_1321': ['pydvr'],'h_1133':['gogo','pais','pako','honb'],
    'h_1155': ['crvr'], 'h_910': ['VRTM'], 'h_921': ['^hj$'], 'h_346': ['rebd'], 'h_1495': ['bank'],'h_1596':['gns'],
    '': [] # zfill(3)
}

DBMSIN_IMG = {
    'MGS' : ["abw"] # https://db.msin.jp/jp.images/cover/MGS/ABW-312.jpg
}

# MGS 품번에는 숫자가 없는데, 링크에는 숫자가 있는것 / 앞에 숫자 알아내기
DBMSIN_NUM_AMA_IMG =[
    '298GOGO','298PAIS','077GBD','324SRTD','271GS','390JNT','326KFNE','446KHOM','554SPIVR','107MSFH','563PPZ','390JAC','112SVVRT','224DTSL','201FONE','298PAKO','201CIEL','201DORI','002HODV','336KNB','595CHNYM','118RCTD','278GNAB','435MFC','300MAAN','480FRIN','277DCV','300NTK','259LUXU','230ORECO','726ANKK','702NOSKN','558KRS','520SSK','223EKBE','043PYM','278GIRO','005AOZ','352KNMD','107SDMUA','026MOND','109IENE','116SHH','307SHIC','1073DSVR','258DTSG','116ACME','336KBI','116NHDTA','107MOGI','336ASI','534IND','107SDMF','336ASI','003T28','201TDMN'
    ]
# matching = [s for s in DBMSIN_NUM_AMA_IMG if "베리" in s] 
# print(matching) #리스트

DBMSIN_UNCEN_IMG = {
    'heyzo' : ["heyzo"],
    'h4610' : ["h4610"],
    'paco' : ["paco"],          
    'carib' : ["carib"],
    "10mu" : ["10mu"],
    'fc2':["fc2-ppv"]
    # https://db.msin.jp/images/cover/carib/carib-010323-001.jpg
}
DBMSIN_AMA_IMG ={
    'FANZA' : ['frin',"scute","pow","sqb","hmdnc","oreco","ankk",'ssk','mgmr'], #https://db.msin.jp/jp.images/cover/FANZA/scute1306.jpg
    'MGS' : ["229scute",'bkynb'],#https://db.msin.jp/jp.images/cover/MGS/229SCUTE-1288.jpg
    'GIGA':["thp","ghov","gigp","spsa"], #https://db.msin.jp/jp.images/cover/GIGA/THP-96.jpg
    "" : [] #MGS 기타등등
}
import urllib.request

headers = {
    'User-Agent' : 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.5359.125 Safari/53.36'
} 
def purifyPumnum(pumnum):
    '''
    품번(adf 2123 또는 asf-1234 형태일것) -> maker 와 num 으로 분리
    '''
    splitID = pumnum.replace(" ","-").split('-')
    splitID[0]
    [maker, num] = [splitID[0].lower().strip(), splitID[1].strip()]

    if maker == "carib": num = splitID[1].strip() + "-" + splitID[2].strip()   # carib-11111-111   
    if maker == "fc2ppv": maker = "fc2-ppv"; num = splitID[-1].strip() # fc2-ppv 12345
    if maker == "fc2": maker = "fc2-ppv"; num = splitID[-1].strip()
    replaceItem = { 'kssis': 'ssis', 'kcawd': 'cawd','iptd':'ipt' }

    for key in replaceItem.keys():
        if maker == key:
            maker = replaceItem[key]

    return [maker, num]

def makeImageURL(pumnum):
    '''
    return -> [url1, url2] / 0 (없음)
    '''
    [maker, num] = purifyPumnum(pumnum)
    print(maker, num, end=" ")

    for key in DBMSIN_IMG:
        if maker in DBMSIN_IMG[key]:
            url = 'https://db.msin.jp/jp.images/cover/'+key+'/'+maker.upper()+'-'+num+'.jpg'
            print(key, url) 
            return url
            
    for key in DBMSIN_UNCEN_IMG:
        if maker in DBMSIN_UNCEN_IMG[key]:
            url = 'https://db.msin.jp/images/cover/'+key+'/'+maker.lower()+'-'+num+'.jpg'
            print(key, url) 
            return url
            
    if len(maker) > 2: #3글자 이상일때
        if maker[0:3].isdigit() is False : #앞에 숫자가 없으면
            digitMaker = [s for s in DBMSIN_NUM_AMA_IMG if maker.upper() in s] #숫자 찾아내기
            if digitMaker != []: 
                url = 'https://db.msin.jp/jp.images/cover/MGS/'+digitMaker[0].upper()+'-'+num+'.jpg'
                req = urllib.request.Request(url=url, headers=headers)
                res = urllib.request.urlopen(req).geturl()
                if res != "https://db.msin.jp/404": print(digitMaker[0], url); return url
    
    for key in DBMSIN_AMA_IMG: # 앞에 숫자 있든 없든..
        if maker in DBMSIN_AMA_IMG[key]:
            if key == 'FANZA': url = 'https://db.msin.jp/jp.images/cover/'+key+'/'+maker.lower()+num+'.jpg' #scute
            else : url = 'https://db.msin.jp/jp.images/cover/'+key+'/'+maker.upper()+'-'+num+'.jpg' #229scute
            
            req = urllib.request.Request(url=url, headers=headers)
            res = urllib.request.urlopen(req).geturl()
            if res != "https://db.msin.jp/404": print(key, url); return url
            
            if maker[0:3].isdigit() :  #229scute 일경우
                url = 'https://db.msin.jp/jp.images/cover/FANZA/'+maker[3:].lower()+num+'.jpg'
                req = urllib.request.Request(url=url, headers=headers)
                res = urllib.request.urlopen(req).geturl()
                if res != "https://db.msin.jp/404": print(key, url); return url
            else : #scute 일경우 -> 앞에 숫자 알아내서 붙이기,
                digitMaker = [s for s in DBMSIN_NUM_AMA_IMG if maker.upper() in s]
                if digitMaker != []: 
                    url = 'https://db.msin.jp/jp.images/cover/MGS/'+digitMaker[0].upper()+'-'+num+'.jpg'
                    req = urllib.request.Request(url=url, headers=headers)
                    res = urllib.request.urlopen(req).geturl()
                    if res != "https://db.msin.jp/404": print(digitMaker[0], url); return url
        
        if key == '':
            url = 'https://db.msin.jp/jp.images/cover/MGS/'+maker.upper()+'-'+num+'.jpg'
            req = urllib.request.Request(url=url, headers=headers)
            res = urllib.request.urlopen(req).geturl()
            if res != "https://db.msin.jp/404":  print(key, url); return url

    for key in PRESTIGE_ITEMS:
        if maker in PRESTIGE_ITEMS[key] : 
            url = [f'https://image.mgstage.com/images/'+key+'/'+maker+'/'+num+'/pb_e_'+maker+'-'+num+'.jpg',  #신작?
               f'https://www.prestige-av.com/api/media/goods/'+key+'/'+maker+'/'+num+'/pb_'+maker+'-'+num+'.jpg']
                
            print(key, url)
            return url

    for key in ALL_ITEMS:

        #소문자, 대문자
        if maker.lower() in ALL_ITEMS[key] or maker.upper() in ALL_ITEMS[key]:
            url = [f'https://pics.r18.com/digital/video/'+key+maker+num.zfill(5)+'/'+key+maker+num.zfill(5)+'pl.jpg', #작은 이미지 
               f'https://pics.dmm.co.jp/mono/movie/adult/'+key+maker+num+'/'+key+maker+num+'pl.jpg'] #큰 이미지

            req = urllib.request.Request(url=url[0], headers=headers)
            res1 = urllib.request.urlopen(req).geturl()
            if res1.find("now_printing") == -1: print(key, url); return url[0]
            req = urllib.request.Request(url=url[1], headers=headers)
            res2 = urllib.request.urlopen(req).geturl()
            if res2.find("now_printing") == -1: print(key, url); return url[1]
        
        #나머지 전부
        if key=='':
            url = [f'https://pics.r18.com/digital/video/'+maker+num.zfill(5)+'/'+maker+num.zfill(5)+'pl.jpg', #작은 이미지 
                   f'https://pics.dmm.co.jp/mono/movie/adult/'+maker+num+'/'+maker+num+'pl.jpg']
            req = urllib.request.Request(url=url[0], headers=headers)
            res1 = urllib.request.urlopen(req).geturl()
            if res1.find("now_printing") == -1: print(key, url); return url[0]
            req = urllib.request.Request(url=url[1], headers=headers)
            res2 = urllib.request.urlopen(req).geturl()
            if res2.find("now_printing") == -1: print(key, url); return url[1]
        
    print("img url 없음")
    return 0

def makeVideoURL(pumnum):
    '''return -> url / 0 (없음)'''
    [maker, num] = purifyPumnum(pumnum)
    if ('heyzo' or '1pondo' or 'pacopaco' or 'carib' or '10musume') in maker:
        return 0
    elif ('fc2') in maker:
        return f'https://db.msin.jp/sampleplay?id=fc2-ppv-{num}'

    for key in PRESTIGE_ITEMS:
        if maker in PRESTIGE_ITEMS[key]:
            url = f'https://www.prestige-av.com/api/media/movie/'+maker.upper()+'-'+num+'.mp4'
            # print(key, url)  
            return url
            
    for key in AMA:
        if maker in AMA[key]:
            url = 'https://sample.mgstage.com/sample/'+key+'/'+maker+'/'+num+'/'+maker+'-'+num+'_sample.mp4'
            # print(key, url)  
            return url
    
    for key in ALL_ITEMS: 
        if maker[0:3].isdigit() is True: maker = maker[3:] #품번앞에 숫자가 붙어있는지 확인
        
        chk = False

        if maker in ALL_ITEMS[key]:
            # print(key, url)  
            chk = True
        elif key == '':
            # print(key, url)  
            chk = True
        
        if chk == True:
            try: #url 살아잇으면 zfill(3)
                newID = key+maker+num.zfill(3)
                firstLetter = newID[0]
                threeLetter = newID[0:3]
                url = 'https://cc3001.dmm.co.jp/litevideo/freepv/'+firstLetter+'/'+threeLetter+'/'+newID+'/'+newID+'_dmb_w.mp4'
                res = urllib.request.urlopen(url) 
                return url
            except: #죽어있으면 zfill(5)
                newID = key+maker+num.zfill(5)
                firstLetter = newID[0]
                threeLetter = newID[0:3]
                url = 'https://cc3001.dmm.co.jp/litevideo/freepv/'+firstLetter+'/'+threeLetter+'/'+newID+'/'+newID+'_dmb_w.mp4'
                return url
    print("video url 없음")
    return 0
