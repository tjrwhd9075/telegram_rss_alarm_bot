PRESTIGE_ITEMS = {
    'prestige': ['chn','gdl','afs','drc','esk','hrv','yrh','ama','abs','abp','bgn','sga','ppt','pxh','mgt','tus','tre','gwjac','vpc'],
    'kanbi': ['kpb','dtt'],
    'doc': ['cdc','sim','fcp','docp'],
    'onemore': ['onez'],
    'shiroutotv': ['siv'],
    'mbm': ['kum'],
    'projectdiamond': ['prb'],
    'jackson': ['jac','jnt'],
    'gets': ['ggen','gyan','gnab','gzap'],
    'kurofune': ['kfne'],
    'nanpatv': ['npv'],
    'luxutv': ['lxv'],
    'documentv': ['dcv']
}

AMA = {
    'nanpatv' : ["200gana"],
    'hamedori2nd' : ["328hmdnc"],
    'ara' : ["261ara"],
    'luxutv' : ["259luxu"],
    'prestige':["ymym"],
    'shirouto' : ['siro'],
    'scute' : ['229scute']
}

ALL_ITEMS = {
    '1': ["hunta",'drpt','mgold','votan','noskn','paioh','bkynb','mtall','hunt','sdfk','silku','star','stars','sdjs','sdnm','kmhr','sdth','kuse','sdab','sdmm','danuhd','nyh','zozo','ftht','akdl','silks','sdam','sdde','kire','shn','fsdss','fsvss','nhdtb','svdvd','iesp','piyo','dldss','sun','dandy','rctd','hawa','sw','ienf','gs','hbad','okb','dandan','nhvr','havd','mtvr','iesm','ftdss','okp','oks','svomn','hypn','SDNT','SDMU','NTTR','FSET','SHYN','DVDM','MIHA'],
    '2': ['dfe','wfr','ekw','wpvr','wkd'], 
    '12': ['bur','lol','imo','scr'], '13': ['GVG','dsvr','gqe','ovg','yvg','rvg'],
    '18': ['mght','sprd','ntrd','spbx'], 
    '24': ['dfbvr','vdd','ped'], 
    '30': ['nha','msc','msa'],
    '36': ['doks','drop','DKWT'], 
    '42': ['sp'],     '55': ['DAVK','tmavntgvr','T28'], 
    '57': ['jksr','mcsr','itsr','bdsr','husr','sgsr'],
    '71': ['gas'],    '84': ['mdtm','mkmp','KMVR','UMSO'], 
    '86': ['axdvd'], '100': ['tv','yen'],     '125': ['umd'], '143': ['SHM'],     '149': ['rd'],    '171': ['lhtd'], '172': ['XRW'], '189': ['hsf'], '301': ['mbdd'],
    '422': ['kagd'], '433': ['gun','neo'], '436': ['bubb'], '5013': ['tsds'], '504': ['IBW'],'540':['yst'],
    '5443': ['LOOTA'], '5448': ['mwkd'], '5561': ['brth','flvr11','lvid','ftsh','vntg','SHMO'], 
    '5581': ['pitv'], '5642': ['bndv','hodv'],    'h_068':['mxgs'], 'h_890':['mist'], 'h_1337': ['WVR9C'],
    'h_1368': ['komz'], 'h_254': ['kir','ofku','spz','vnds','doki','mgdn','dmat','udak','nxg','kazk','eih'],
    'h_1248': ['kiwvr'], 'h_1462': ['com','pyu'], 'h_706': ['anda','coch','gredb','prbyb','sbmo','sprbd','thnib','ppmn'],
    'h_244': ['SABA','SUPA'], 'h_1575': ['sgkx'], 'h_1256': ['tpvr','tprm'], 'h_1127': ['VOVS','gopj','vosf','vosm'],
    'h_1116': ['cafuku','cami','casmani','cafr','capi','cabe','caca'], 'h_019': ['acz','kck'],
    'h_1100': ['hzgd','hzhb'], 'h_1000': ['spye'], 'h_1001': ['oyaj'], 'h_1160': ['meko'],'h_1605':["stsk"],
    'h_1231': ['^ss$'], 'h_1300': ['mtes'],
    'h_1435': ['clo','bth'], 'h_1573': ['ftuj'], 'h_1577': ['favkh','fbcpv'], 'h_496': ['dogd'],
    'h_574': ['iqpa'], 'h_1569': ['nkkvr'], 'h_086': ['fera','keed','jrze','jura','mesu','nuka','abba','cvdx','toen','zeaa','iqqq','hima','ferax','iga','kaad','hone'],
    'h_1002': ['jgaho'], 'h_1386': ['dinm'], 'h_1492': ['siror'], 'h_1587': ['ein'], 'h_720': ['zex'],
    'h_1416': ['^ad$'], 'h_1563': ['mol'], 'h_094': ['ktra'], 'h_796': ['much'],
    'h_458': ['hsm'], 'h_1304': ['^tg$'], 'h_1526': ['pm'], 'h_1342': ['nsm'], 'h_1440': ['fgan'],
    'h_1594': ['spro'], 'h_1096': ['bdsm'], 'h_113': ['^(bbacos','cb','ek','kpp','spo','sw)$'],
    'h_1165': ['goju'], 'h_1553': ['ftvr'], 'h_1560': ['shind'],
    'h_1345': ['GNAX'], 'h_1558': ['CSDX'], 'h_1593': ['cubex','fanq','fanx','papak'], 'h_172': ['HMNF'], 'h_1631': ['krs'],
    'h_173': ['ghkr','gtrl','ryoj','tbb','thp'], 'h_1454':['smdy'], 'h_1359':['swdf'],
    'h_189': ['cha','milf','pc','tsm','uta','vio'], 'h_237': ['find','ambi','ambs','clot','hdka','nacr','nacx','zmar'],
    'h_897': ['nmk'], 'h_101': ['^gs$'], 'h_227': ['jukf'], 'h_1324': ['skmj'], 'h_1240': ['milk'],'h_1112':['nubi'],
    'h_1472': ['hmvf','stvf'], 'h_1378': ['arso'], 'h_580': ['tms'], 'h_1533': ['can'], 'h_1321': ['pydvr'],'h_1133':['honb'],
    'h_1155': ['crvr'], 'h_910': ['VRTM'], 'h_921': ['^hj$'], 'h_346': ['rebd'], 'h_1495': ['bank'],'h_1596':['gns'],
    '': [] # zfill(3)
}

DBMSIN_IMG = {
    'MGS' : ["abw"] # https://db.msin.jp/jp.images/cover/MGS/ABW-312.jpg
}

DBMSIN_NUM_AMA_IMG ={ # MGS 품번에는 숫자가 없는데, 링크에는 숫자가 있는것
    '534IND' : ["ind"], 
    '003T28' : ["t28"],
    '107MOGI': ["mogi"], #https://db.msin.jp/jp.images/cover/MGS/107MOGI-071.jpg
    '336KBI' : ["kbi"]
}
DBMSIN_UNCEN_IMG = {
    'heyzo' : ["heyzo"],
    'h4610' : ["h4610"],
    'paco' : ["paco"],          
    'carib' : ["carib"],
    "10mu" : ["10mu"]
    # https://db.msin.jp/images/cover/carib/carib-010323-001.jpg
}
DBMSIN_AMA_IMG ={
    'FANZA' : ["scute"], #https://db.msin.jp/jp.images/cover/FANZA/scute1306.jpg
    'MGS' : ["229scute"],#https://db.msin.jp/jp.images/cover/MGS/229SCUTE-1288.jpg
    'GIGA':["thp","ghov","gigp","spsa"], #https://db.msin.jp/jp.images/cover/GIGA/THP-96.jpg
    "" : []
}


import urllib.request

headers = {
    'User-Agent' : 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.5359.125 Safari/53.36'
} 
def purifyPumnum(pumnum):
    '''
    품번(adf 2123 또는 asf-1234 형태일것) -> maker 와 num 으로 분리
    '''
    splitID = pumnum.replace(" ","-").split('-')
    splitID[0]
    [maker, num] = [splitID[0].lower().strip(), splitID[1].strip()]

    if maker == "carib": num = splitID[1].strip() + "-" + splitID[2].strip()   # carib-11111-111   
    if maker == "fc2": maker = "fc2-ppv"; num = splitID[-1].strip()
    replaceItem = { 'kssis': 'ssis', 'kcawd': 'cawd','iptd':'ipt' }

    for key in replaceItem.keys():
        if maker == key:
            maker = replaceItem[key]

    return [maker, num]

def makeImageURL(pumnum):
    '''
    return -> [url1, url2] / 0 (없음)
    '''
    [maker, num] = purifyPumnum(pumnum)
    print(maker, num, end=" ")

    for key in PRESTIGE_ITEMS:
        url = [f'https://image.mgstage.com/images/'+key+'/'+maker+'/'+num+'/pb_e_'+maker+'-'+num+'.jpg',  #신작?
               f'https://www.prestige-av.com/api/media/goods/'+key+'/'+maker+'/'+num+'/pb_'+maker+'-'+num+'.jpg']
               
        #저장된 키가 소문자
        if maker in PRESTIGE_ITEMS[key] : 
            print(key, url) 
            return url
        #대문자
        if maker.upper() in PRESTIGE_ITEMS[key] : 
            print(key, url)  
            return url

    for key in DBMSIN_IMG:
        if maker in DBMSIN_IMG[key]:
            url = 'https://db.msin.jp/jp.images/cover/'+key+'/'+maker.upper()+'-'+num+'.jpg'
            print(key, url) 
            return url
            
    for key in DBMSIN_UNCEN_IMG:
        if maker in DBMSIN_UNCEN_IMG[key]:
            url = 'https://db.msin.jp/images/cover/'+key+'/'+maker.lower()+'-'+num+'.jpg'
            print(key, url) 
            return url

    for key in DBMSIN_NUM_AMA_IMG:
        if maker in DBMSIN_NUM_AMA_IMG[key]:
            url = 'https://db.msin.jp/jp.images/cover/MGS/'+key.upper()+'-'+num+'.jpg'
            print(key, url) 
            return url
    
    for key in DBMSIN_AMA_IMG:
        if maker in DBMSIN_AMA_IMG[key]:
            if key == 'FANZA': url = 'https://db.msin.jp/jp.images/cover/'+key+'/'+maker.lower()+num+'.jpg' #scute
            else : url = 'https://db.msin.jp/jp.images/cover/'+key+'/'+maker.upper()+'-'+num+'.jpg' #229scute
            
            req = urllib.request.Request(url=url, headers=headers)
            res = urllib.request.urlopen(req).geturl()
            if res != "https://db.msin.jp/404": print(key, url); return url

            if maker == "scute": url = 'https://db.msin.jp/jp.images/cover/MGS/229SCUTE'+'-'+num+'.jpg'; return url
            elif maker == "229scute": url = 'https://db.msin.jp/jp.images/cover/FANZA/scute'+num+'.jpg'; return url
        
        if key == '':
            url = 'https://db.msin.jp/jp.images/cover/MGS/'+maker.upper()+'-'+num+'.jpg'
            req = urllib.request.Request(url=url, headers=headers)
            res = urllib.request.urlopen(req).geturl()
            if res != "https://db.msin.jp/404":  print(key, url); return url

    for key in ALL_ITEMS:
        
        url = [f'https://pics.r18.com/digital/video/'+key+maker+num.zfill(5)+'/'+key+maker+num.zfill(5)+'pl.jpg', #작은 이미지 
               f'https://pics.dmm.co.jp/mono/movie/adult/'+key+maker+num+'/'+key+maker+num+'pl.jpg'] #큰 이미지

        req = urllib.request.Request(url=url[0], headers=headers)
        res1 = urllib.request.urlopen(req).geturl()
        req = urllib.request.Request(url=url[1], headers=headers)
        res2 = urllib.request.urlopen(req).geturl()
        print([res1, res2])

        noPrintUrl = 'http://pics.dmm.co.jp/mono/movie/n/now_printing/now_printing.jpg'

        #소문자, 대문자
        if maker.lower() in ALL_ITEMS[key] or maker.upper() in ALL_ITEMS[key]:
            if res1 != noPrintUrl: print(key, url); return url[0]
            if res2 != noPrintUrl: print(key, url); return url[1]
        
        #나머지 전부
        if key=='':
            url = [f'https://pics.r18.com/digital/video/'+maker+num.zfill(5)+'/'+maker+num.zfill(5)+'pl.jpg', #작은 이미지 
                   f'https://pics.dmm.co.jp/mono/movie/adult/'+maker+num+'/'+maker+num+'pl.jpg']
            req = urllib.request.Request(url=url[0], headers=headers)
            res1 = urllib.request.urlopen(req).geturl()
            req = urllib.request.Request(url=url[1], headers=headers)
            res2 = urllib.request.urlopen(req).geturl()
            if res1 != noPrintUrl: print(key, url); return url[0]
            if res2 != noPrintUrl: print(key, url); return url[1]
        
    print("img url 없음")
    return 0

def makeVideoURL(pumnum):
    '''return -> url / 0 (없음)'''
    [maker, num] = purifyPumnum(pumnum)
    if ('heyzo' or '1pondo' or 'pacopaco' or 'carib' or '10musume') in maker:
        return 0
    elif ('fc2') in maker:
        return f'https://db.msin.jp/sampleplay?id=fc2-ppv-{num}'

    for key in PRESTIGE_ITEMS:
        #소문자
        if maker in PRESTIGE_ITEMS[key]:
            url = f'https://www.prestige-av.com/api/media/movie/'+maker.upper()+'-'+num+'.mp4'
            # print(key, url)  
            return url
        #대문자
        elif maker.upper() in PRESTIGE_ITEMS[key]:
            url = f'https://www.prestige-av.com/api/media/movie/'+maker.upper()+'-'+num+'.mp4'
            # print(key, url)  
            return url 
            
    for key in AMA:
        if maker in AMA[key]:
            url = 'https://sample.mgstage.com/sample/'+key+'/'+maker+'/'+num+'/'+maker+'-'+num+'_sample.mp4'
            # print(key, url)  
            return url
    
    for key in ALL_ITEMS: 
        if maker[0:3].isdigit() is True: maker = maker[3:] #품번앞에 숫자가 붙어있는지 확인
        
        chk = False

        #소문자
        if maker in ALL_ITEMS[key]:
            # print(key, url)  
            chk = True
        #대문자
        elif maker.upper() in ALL_ITEMS[key]:
            # print(key, url)  
            chk = True
        elif key == '':
            # print(key, url)  
            chk = True
        
        if chk == True:
            try: #url 살아잇으면 zfill(3)
                newID = key+maker+num.zfill(3)
                firstLetter = newID[0]
                threeLetter = newID[0:3]
                url = 'https://cc3001.dmm.co.jp/litevideo/freepv/'+firstLetter+'/'+threeLetter+'/'+newID+'/'+newID+'_dmb_w.mp4'
                res = urllib.request.urlopen(url) 
                return url
            except: #죽어있으면 zfill(5)
                newID = key+maker+num.zfill(5)
                firstLetter = newID[0]
                threeLetter = newID[0:3]
                url = 'https://cc3001.dmm.co.jp/litevideo/freepv/'+firstLetter+'/'+threeLetter+'/'+newID+'/'+newID+'_dmb_w.mp4'
                return url
    print("video url 없음")
    return 0

# pumnum ="CAWD-434"
# makeImageURL(pumnum)
# makeVideoURL(pumnum)

# print(makeImageURL("CAWD-434"))